DROP TABLE IF EXISTS pokemons;
DROP TYPE IF EXISTS pokemon_ability;
DROP TYPE IF EXISTS pokemon_type;

-------------------------------------------------------------------------------

CREATE OR REPLACE FUNCTION array_distinct_item(arr anyarray)
RETURNS boolean AS $$
BEGIN
  RETURN cardinality(arr) = cardinality(array(SELECT DISTINCT unnest(arr)));
END;
$$ LANGUAGE plpgsql IMMUTABLE;

CREATE TYPE pokemon_ability AS ENUM(
  'ADAPTABILITY',
  'AFTERMATH',
  'AIR_LOCK',
  'ANGER_POINT',
  'ANGER_SHELL',
  'ANTICIPATION',
  'ARENA_TRAP',
  'ARMOR_TAIL',
  'AROMA_VEIL',
  'AURA_BREAK',
  'BAD_DREAMS',
  'BALL_FETCH',
  'BATTERY',
  'BATTLE_ARMOR',
  'BEADS_OF_RUIN',
  'BEAST_BOOST',
  'BERSERK',
  'BIG_PECKS',
  'BLAZE',
  'BULLETPROOF',
  'CHEEK_POUCH',
  'CHILLING_NEIGH',
  'CHLOROPHYLL',
  'CLEAR_BODY',
  'CLOUD_NINE',
  'COLOR_CHANGE',
  'COMATOSE',
  'COMMANDER',
  'COMPETITIVE',
  'COMPOUND_EYES',
  'CONTRARY',
  'CORROSION',
  'COTTON_DOWN',
  'CUD_CHEW',
  'CURSED_BODY',
  'CUTE_CHARM',
  'DAMP',
  'DANCER',
  'DARK',
  'AURA',
  'DAUNTLESS_SHIELD',
  'DAZZLING',
  'DEFEATIST',
  'DEFIANT',
  'DISGUISE',
  'DOWNLOAD',
  'DRAGONS_MAW',
  'DRIZZLE',
  'DROUGHT',
  'DRY_SKIN',
  'EARLY_BIRD',
  'EARTH_EATER',
  'EFFECT_SPORE',
  'ELECTRIC_SURGE',
  'ELECTROMORPHOSIS',
  'EMERGENCY_EXIT',
  'FAIRY_AURA',
  'FILTER',
  'FLAME_BODY',
  'FLASH_FIRE',
  'FLOWER_GIFT',
  'FLOWER_VEIL',
  'FLUFFY',
  'FORECAST',
  'FOREWARN',
  'FRIEND_GUARD',
  'FRISK',
  'FULL_METAL_BODY',
  'FUR_COAT',
  'GLUTTONY',
  'GOOD_AS_GOLD',
  'GOOEY',
  'GRASSY_SURGE',
  'GRIM_NEIGH',
  'GUARD_DOG',
  'GULP_MISSILE',
  'GUTS',
  'HADRON_ENGINE',
  'HEALER',
  'HEATPROOF',
  'HEAVY_METAL',
  'HONEY_GATHER',
  'HOSPITALITY',
  'HUGE_POWER',
  'HUNGER_SWITCH',
  'HUSTLE',
  'HYDRATION',
  'HYPER_CUTTER',
  'ICE_BODY',
  'ICE_FACE',
  'ILLUMINATE',
  'ILLUSION',
  'IMMUNITY',
  'INFILTRATOR',
  'INNARDS_OUT',
  'INNER_FOCUS',
  'INSOMNIA',
  'INTIMIDATE',
  'INTREPID_SWORD',
  'IRON_BARBS',
  'IRON_FIST',
  'JUSTIFIED',
  'KEEN_EYE',
  'KLUTZ',
  'LEAF_GUARD',
  'LEVITATE',
  'LIGHT_METAL',
  'LIGHTNING_ROD',
  'LIMBER',
  'LINGERING_AROMA',
  'LIQUID_OOZE',
  'MAGIC_GUARD',
  'MAGICIAN',
  'MAGMA_ARMOR',
  'MAGNET_PULL',
  'MARVEL_SCALE',
  'MEGA_LAUNCHER',
  'MERCILESS',
  'MINUS',
  'MISTY_SURGE',
  'MOLD_BREAKER',
  'MOTOR_DRIVE',
  'MOXIE',
  'MULTITYPE',
  'MUMMY',
  'MYCELIUM_MIGHT',
  'NATURAL_CURE',
  'NEUTRALIZING_GAS',
  'NO_GUARD',
  'NORMALIZE',
  'OBLIVIOUS',
  'OPPORTUNIST',
  'ORICHALCUM_PULSE',
  'OVERCOAT',
  'OVERGROW',
  'OWN_TEMPO',
  'PICKPOCKET',
  'PICKUP',
  'PLUS',
  'POISON_HEAL',
  'POISON_POINT',
  'POISON_PUPPETEER',
  'POISON_TOUCH',
  'POWER_SPOT',
  'PRANKSTER',
  'PRESSURE',
  'PRISM_ARMOR',
  'PROTOSYNTHESIS',
  'PSYCHIC_SURGE',
  'PUNK_ROCK',
  'PURE_POWER',
  'PURIFYING_SALT',
  'QUARK_DRIVE',
  'QUEENLY_MAJESTY',
  'QUICK_FEET',
  'RKS_SYSTEM',
  'RAIN_DISH',
  'RATTLED',
  'RECEIVER',
  'RECKLESS',
  'REFRIGERATE',
  'REGENERATOR',
  'RIPEN',
  'RIVALRY',
  'ROCK_HEAD',
  'ROUGH_SKIN',
  'RUN_AWAY',
  'SAND_FORCE',
  'SAND_RUSH',
  'SAND_SPIT',
  'SAND_STREAM',
  'SAND_VEIL',
  'SAP_SIPPER',
  'SCHOOLING',
  'SCRAPPY',
  'SCREEN_CLEANER',
  'SEED_SOWER',
  'SERENE_GRACE',
  'SHADOW_SHIELD',
  'SHADOW_TAG',
  'SHARPNESS',
  'SHED_SKIN',
  'SHEER_FORCE',
  'SHELL_ARMOR',
  'SHIELD_DUST',
  'SHIELDS_DOWN',
  'SIMPLE',
  'SKILL_LINK',
  'SLOW_START',
  'SLUSH_RUSH',
  'SNIPER',
  'SNOW_CLOAK',
  'SNOW_WARNING',
  'SOLAR_POWER',
  'SOLID_ROCK',
  'SOUL_HEART',
  'SOUNDPROOF',
  'SPEED_BOOST',
  'STAKEOUT',
  'STALL',
  'STAMINA',
  'STANCE_CHANGE',
  'STATIC',
  'STEADFAST',
  'STEAM_ENGINE',
  'STEELWORKER',
  'STENCH',
  'STICKY_HOLD',
  'STORM_DRAIN',
  'STRONG_JAW',
  'STURDY',
  'SUCTION_CUPS',
  'SUPER_LUCK',
  'SUPERSWEET_SYRUP',
  'SUPREME_OVERLORD',
  'SWARM',
  'SWEET_VEIL',
  'SWIFT_SWIM',
  'SWORD_OF_RUIN',
  'SYNCHRONIZE',
  'TABLETS_OF_RUIN',
  'TANGLED_FEET',
  'TECHNICIAN',
  'TELEPATHY',
  'TERA_SHIFT',
  'TERAVOLT',
  'THERMAL_EXCHANGE',
  'THICK_FAT',
  'TINTED_LENS',
  'TORRENT',
  'TOUGH_CLAWS',
  'TOXIC_CHAIN',
  'TOXIC_DEBRIS',
  'TRACE',
  'TRANSISTOR',
  'TRIAGE',
  'TRUANT',
  'TURBOBLAZE',
  'UNAWARE',
  'UNBURDEN',
  'UNNERVE',
  'UNSEEN_FIST',
  'VESSEL_OF_RUIN',
  'VICTORY_STAR',
  'VITAL_SPIRIT',
  'VOLT_ABSORB',
  'WANDERING_SPIRIT',
  'WATER_ABSORB',
  'WATER_BUBBLE',
  'WATER_COMPACTION',
  'WATER_VEIL',
  'WEAK_ARMOR',
  'WELL_BAKED_BODY',
  'WHITE_SMOKE',
  'WIMP_OUT',
  'WIND_POWER',
  'WIND_RIDER',
  'WONDER_GUARD',
  'WONDER_SKIN',
  'ZERO_TO_HERO'
);

CREATE TYPE pokemon_type AS ENUM(
  'BUG',
  'DRAGON',
  'FAIRY',
  'FIRE',
  'GHOST',
  'GROUND',
  'NORMAL',
  'PSYCHIC',
  'STEEL',
  'DARK',
  'ELECTRIC',
  'FIGHTING',
  'FLYING',
  'GRASS',
  'ICE',
  'POISON',
  'ROCK',
  'WATER'
);

CREATE TABLE pokemons (
  id          SERIAL             NOT NULL,
  name        TEXT               NOT NULL UNIQUE,
  description TEXT               NOT NULL DEFAULT '',
  category    TEXT               NOT NULL DEFAULT '',
  types       pokemon_type[]     NOT NULL DEFAULT array[]::pokemon_type[],
  abilities   pokemon_ability[]  NOT NULL DEFAULT array[]::pokemon_ability[]

  CHECK (array_distinct_item(types) AND array_distinct_item(abilities))
);
